[JLScript]
Version=1
Name=\x421\x43a\x440\x438\x43f\x442\x32
Notes=
Encrypted=false
LogRowsCount=20000
Data="//========== * \x41e\x431\x449\x438\x435 \x43f\x43e\x43b\x44c\x437\x43e\x432\x430\x442\x435\x43b\x44c\x441\x43a\x438\x435 \x43d\x430\x441\x442\x440\x43e\x439\x43a\x438 \x441\x442\x440\x430\x442\x435\x433\x438\x438 * ===//   \nvar Deposit = 10.0;\t// \x420\x430\x437\x43c\x435\x440 \x434\x435\x43f\x43e\x437\x438\x442\x430, \x43a\x43e\x442\x43e\x440\x44b\x439 \x434\x430\x435\x43c \x431\x43e\x442\x443 \x434\x43b\x44f \x442\x43e\x440\x433\x43e\x432\x43b\x438\nvar ProfitSize = 0.6;\t// \x420\x430\x431\x43e\x442\x430\x435\x442. \x443\x440\x43e\x432\x435\x43d\x44c \x43f\x440\x43e\x444\x438\x43d\x430. \x43d\x430\x434\x43e \x437\x430\x43a\x43b\x430\x434\x44b\x432\x430\x442\x44c \x432\x441\x435 \x43a\x43e\x43c\x438\x441\x441\x438\x438 \x432 \x43f\x440\x43e\x446\x435\x43d\x442\x430\x445!!!\nvar OrdersAmnt = 10;\t// \x41c\x430\x43a\x441\x438\x43c\x430\x43b\x44c\x43d\x43e\x435 \x43a\x43e\x43b\x438\x447\x435\x441\x442\x432\x43e \x43e\x440\x434\x435\x440\x43e\x432 \x43d\x430 \x43f\x43e\x43a\x443\x43f\x43a\x443. \x428\x430\x433 \x43c\x435\x436\x434\x443 \x43e\x440\x434\x435\x440\x430\x43c\x438 \x431\x443\x434\x435\x442 \x440\x430\x441\x447\x438\x442\x430\x43d \x43a\x430\x43a \x448\x438\x440\x438\x43d\x430 \x43a\x43e\x440\x438\x434\x43e\x440\x430 \x434\x435\x43b\x435\x43d\x43d\x430\x44f \x43d\x430 \x44d\x442\x43e\x442 \x43f\x430\x440\x430\x43c\x435\x442\x440.\nvar PercMaxPrice = 1;\t// \x412\x435\x440\x445\x43d\x438\x439 \x443\x440\x43e\x432\x435\x43d\x44c \x446\x435\x43d\x43e\x432\x43e\x433\x43e \x43a\x43e\x440\x438\x434\x43e\x440\x430 \x43e\x442\x43d\x43e\x441\x438\x442\x435\x43b\x44c\x43d\x43e \x442\x435\x43a\x443\x449\x435\x439 \x446\x435\x43d\x44b (\x434\x43b\x44f \x440\x435\x436\x438\x43c\x430 1) \x438\x43b\x438 \x441\x443\x442\x43e\x447\x43d\x43e\x433\x43e \x43c\x430\x43a\x441\x438\x43c\x443\x43c\x430 (\x434\x43b\x44f \x440\x435\x436\x438\x43c\x430 2) \x432 %.\nvar PercMinPrice = 1;\t// \x41d\x438\x436\x43d\x438\x439 \x443\x440\x43e\x432\x435\x43d\x44c \x446\x435\x43d\x43e\x432\x43e\x433\x43e \x43a\x43e\x440\x438\x434\x43e\x440\x430 \x43e\x442\x43d\x43e\x441\x438\x442\x435\x43b\x44c\x43d\x43e \x442\x435\x43a\x443\x449\x435\x439 \x446\x435\x43d\x44b (\x434\x43b\x44f \x440\x435\x436\x438\x43c\x430 1) \x438\x43b\x438 \x441\x443\x442\x43e\x447\x43d\x43e\x433\x43e \x43c\x430\x43a\x441\x438\x43c\x443\x43c\x430 (\x434\x43b\x44f \x440\x435\x436\x438\x43c\x430 2) \x432 %.\nvar MinVolume = 0.01;\t// \x41c\x438\x43d\x438\x43c\x430\x43b\x44c\x43d\x44b\x439 \x43e\x431\x44a\x435\x43c \x43a\x440\x438\x43f\x442\x44b \x434\x43b\x44f \x441\x434\x435\x43b\x43e\x43a. \x41f\x43e\x43a\x430 \x43d\x435 \x438\x441\x43f\x43e\x43b\x44c\x437\x443\x435\x442\x441\x44f\nvar vh = 0.003;\t\t// \x428\x430\x433 \x43f\x43e \x446\x435\x43d\x435, \x435\x441\x43b\x438 0, \x442\x43e \x441\x447\x438\x442\x430\x435\x442\x441\x44f \x441\x430\x43c \x438\x441\x445\x43e\x434\x44f \x438\x437 \x43f\x430\x440\x430\x43c\x435\x442\x440\x43e\x432 \x432\x44b\x448\x435\n//========== * \x41d\x430\x441\x442\x440\x439\x43e\x43a\x438 \x441\x435\x442\x43a\x438 \x43e\x440\x434\x435\x440\x43e\x432 * ================//\t\nvar Symbol = \"BTCUSD\";\t// \x442\x440\x435\x431\x443\x435\x442\x441\x44f \x434\x43b\x44f \x43e\x43f\x440\x435\x434\x435\x43b\x435\x43d\x438\x44f \x43e\x440\x434\x435\x440\x43e\x432 \x442\x43e\x43b\x44c\x43a\x43e \x434\x43b\x44f \x44d\x442\x43e\x439 \x432\x430\x43b\x44e\x442\x44b; \x41f\x43e\x43a\x430 \x43d\x435 \x43d\x443\x436\x43d\x44b\x439 \x43f\x430\x440\x430\x43c\x435\x442\x440\nvar Spreading = 10;\t// \x41f\x43e\x43a\x430 \x43d\x435 \x440\x430\x431\x43e\x442\x430\x435\x442. \x420\x430\x441\x43f\x440\x435\x434\x435\x43b\x435\x43d\x438\x435 \x43f\x440\x43e\x444\x438\x442\x430 \x432 \x444\x438\x430\x442\x43d\x443\x44e \x438\x43b\x438 \x43a\x440\x438\x43f\x442\x43e\x432\x430\x43b\x44e\x442\x43d\x443\x44e \x447\x430\x441\x442\x438 \x434\x435\x43f\x43e \x432 %\t\nvar Trading = 'long';\t// \x41f\x43e\x43a\x430 \x43d\x435 \x440\x430\x431\x43e\x442\x430\x435\x442. \x412\x438\x434 \x442\x43e\x440\x433\x43e\x432. long - \x43d\x430 \x43f\x43e\x432\x44b\x448\x435\x43d\x438\x435 \x446\x435\x43d\x44b, short - \x43d\x430 \x43f\x43e\x43d\x438\x436\x435\x43d\x438\x435 \x446\x435\x43d\x44b, mix - \x441\x43c\x435\x448\x430\x43d\x44b\x439 \x440\x435\x436\x438\x43c\n\nvar DeltaStepOrder = 0.0;\t//\x41f\x43e\x43a\x430 \x43d\x435 \x440\x430\x431\x43e\x442\x430\x435\x442 \x423\x432\x435\x43b\x438\x447\x435\x43d\x438\x435 \x440\x430\x437\x43c\x435\x440\x430 \x448\x430\x433\x430 \x43e\x440\x434\x435\x440\x43e\x432 \x43f\x440\x438 \x43f\x440\x438\x431\x43b\x438\x436\x435\x43d\x438\x438 \x43a \x43e\x441\x43d\x43e\x432\x430\x43d\x438\x44e \x441\x435\x442\x43a\x438 \x432 %\nvar OrderMode = 1;\t// \x420\x435\x436\x438\x43c \x430\x432\x442\x43e\x43d\x430\x441\x442\x440\x43e\x439\x43a\x438 \x43e\x440\x434\x435\x440\x43e\x432. 0 - \x432\x440\x443\x447\x43d\x443\x44e, 1 - \x43f\x43e \x432\x440\x435\x43c\x435\x43d\x438 \x43e\x442 \x442\x435\x43a\x443\x449\x435\x439 \x446\x435\x43d\x44b, 2 - \x43f\x43e max/min \x441\x443\x442\x43e\x447\x43d\x43e\x439 \x446\x435\x43d\x435. \x41f\x43e\x43a\x430 \x440\x430\x431\x43e\x442\x430\x435\x442 \x442\x43e\x43b\x44c\x43a\x43e 1\nvar ManualMax = 40;\t// \x41c\x430\x43a\x441\x438\x43c\x430\x43b\x44c\x43d\x430\x44f \x446\x435\x43d\x430 \x434\x43b\x44f \x440\x443\x447\x43d\x43e\x433\x43e \x440\x435\x436\x438\x43c\x430\nvar ManualMin = 25;\t// \x41c\x438\x43d\x438\x43c\x430\x43b\x44c\x43d\x430\x447 \x446\x435\x43d\x430 \x434\x43b\x44f \x440\x443\x447\x43d\x43e\x433\x43e \x440\x435\x436\x438\x43c\x430\nvar WaitRebuild = 30;\t// \x41f\x43e\x43a\x430 \x43d\x435 \x440\x430\x431\x43e\x442\x430\x435\x442 \x412\x440\x435\x43c\x44f \x43f\x440\x43e\x441\x442\x43e\x44f \x431\x43e\x442\x430 \x431\x435\x437 \x442\x43e\x440\x433\x43e\x432 \x432 \x43c\x438\x43d\x443\x442\x430\x445, \x43f\x43e\x441\x43b\x435 \x43a\x43e\x442\x43e\x440\x43e\x433\x43e \x431\x443\x434\x435\x442 \x43f\x435\x440\x435\x441\x447\x438\x442\x430\x43d\x430 \x441\x435\x442\x43a\x430\nvar StopLoss = 0;\t// \x41f\x43e\x43a\x430 \x43d\x435 \x440\x430\x431\x43e\x442\x430\x435\x442 \x415\x441\x43b\x438 \x43a\x443\x440\x441 \x431\x443\x434\x435\x442 \x43d\x438\x436\x435 \x43d\x430 \x44d\x442\x443 \x432\x435\x43b\x438\x447\x438\x43d\x443 \x447\x435\x43c \x446\x435\x43d\x430 \x437\x430\x43a\x443\x43f\x43a\x438 \x432 \x43f\x430\x440\x442\x438\x438 \x43f\x430\x440\x442\x438\x44f \x431\x443\x434\x435\x442 \x441\x43b\x438\x442\x430 \x432 \x43c\x438\x43d\x443\x441. \x423\x441\x442\x430\x43d\x43e\x432\x438\x442\x44c \x440\x430\x432\x43d\x44b\x43c 0 \x447\x442\x43e\x431\x44b \x43d\x435 \x438\x441\x43f\x43e\x43b\x44c\x437\x43e\x432\x430\x442\x44c \x441\x43b\x438\x432 \x432 \x43c\x438\x43d\x443\x441.\nvar \x421urrentAskPrice = 0; \t// \x41f\x43e\x43a\x430 \x43d\x435 \x440\x430\x431\x43e\x442\x430\x435\x442. \x412\x441\x435\x433\x434\x430 0. \x41d\x443\x436\x43d\x430 \x434\x43b\x44f \x437\x430\x43f\x43e\x43c\x438\x43d\x430\x43d\x438\x44f \x438 \x432\x43e\x437\x43e\x431\x43d\x43e\x432\x43b\x435\x43d\x438\x44f \x440\x430\x431\x43e\x442\x44b!!! \x415\x441\x43b\x438 0 - \x432\x44b\x447\x438\x441\x43b\x44f\x435\x442\x441\x44f \x442\x435\x43a\x443\x449\x430\x44f, \x438\x43d\x430\x447\x435 \x43e\x441\x442\x430\x435\x442\x441\x44f \x442\x430, \x43a\x43e\x442\x43e\x440\x430\x44f \x443\x43a\x430\x437\x430\x43d\x430.\nvar \x421urrentBidPrice = 0; \t// \x41f\x43e\x43a\x430 \x43d\x435 \x440\x430\x431\x43e\x442\x430\x435\x442. \x412\x441\x435\x433\x434\x430 0. \x41d\x443\x436\x43d\x430 \x434\x43b\x44f \x437\x430\x43f\x43e\x43c\x438\x43d\x430\x43d\x438\x44f \x438 \x432\x43e\x437\x43e\x431\x43d\x43e\x432\x43b\x435\x43d\x438\x44f \x440\x430\x431\x43e\x442\x44b!!! \x415\x441\x43b\x438 0 - \x432\x44b\x447\x438\x441\x43b\x44f\x435\x442\x441\x44f \x442\x435\x43a\x443\x449\x430\x44f, \x438\x43d\x430\x447\x435 \x43e\x441\x442\x430\x435\x442\x441\x44f \x442\x430, \x43a\x43e\x442\x43e\x440\x430\x44f \x443\x43a\x430\x437\x430\x43d\x430.\n\n//=========== * \x414\x430\x43b\x44c\x448\x435 \x442\x43e\x43b\x44c\x43a\x43e \x434\x43b\x44f \x441\x43b\x443\x436\x435\x431\x43d\x43e\x433\x43e \x438\x441\x43f\x43e\x43b\x44c\x437\x43e\x432\x430\x43d\x438\x44f * =//\nvar sVer = '1.1';\nvar SetOrderDelay = 5; // \x41f\x43e\x43a\x430 \x43d\x435 \x440\x430\x431\x43e\x442\x430\x435\x442. \x41a\x43e\x43b\x438\x447\x435\x441\x442\x432\x43e \x441\x435\x43a\x443\x43d\x434 \x43c\x435\x436\x434\x443 \x443\x441\x442\x430\x43d\x43e\x432\x43a\x43e\x439 \x43e\x440\x434\x435\x440\x43e\x432\nvar WaitToSetOrder = 1;\n\n//=========== * \x41d\x435\x43f\x43e\x43d\x44f\x442\x43d\x44b\x435 \x43f\x435\x440\x435\x43c\x435\x43d\x43d\x44b\x435 * ===============//\nvar botSafeLim2 = 0;\n//=========== * \x41e\x442\x43a\x440\x44b\x442\x44b\x435 \x43e\x440\x434\x435\x440\x430 \x434\x43b\x44f \x434\x430\x43d\x43d\x43e\x433\x43e \x441\x43a\x440\x438\x43f\x442\x430* =====//\nvar mOpenOrders = []; \n\n//=========== * \x41e\x440\x434\x435\x440\x430 \x434\x43b\x44f \x434\x430\x43d\x43d\x43e\x433\x43e \x441\x43a\x440\x438\x43f\x442\x430 \x43a\x43e\x442\x43e\x440\x44b\x435 \x43e\x442\x43a\x440\x44b\x432\x430\x442\x44c \x43d\x435 \x43d\x430\x434\x43e* =====//\nvar mNotOpenOrders = []; \nvar mOpenSellOrders = []; \n\n//=========== * \x412\x44b\x43f\x43e\x43b\x43d\x435\x43d\x43d\x44b\x435 \x43e\x440\x434\x435\x440\x430 \x434\x43b\x44f \x434\x430\x43d\x43d\x43e\x433\x43e \x441\x43a\x440\x438\x43f\x442\x430* =====//\nvar mFilledOrders = []; \n\nvar indexDelete = [];\n\n//============ \x41f\x440\x438\x43c\x435\x440 \x44d\x43b\x435\x43c\x435\x43d\x442\x430 \x43c\x430\x441\x441\x438\x432\x430 \x43e\x440\x434\x435\x440\x43e\x432 ======//\nvar oneOrder = {\n\ttype : 0, // 0 - \x41f\x43e\x43a\x443\x43f\x43a\x430,  - \x43f\x440\x43e\x434\x430\x436\x430\n\tprice : 0,\n\tvolume : 0\n}\n\nfunction newOrder (vtype, vprice, vvolume) {\nthis.type = vtype;\nthis.price = vprice;\nthis.volume = vvolume;\n}\n\nvar SetLastOrder = new Date();\nvar MaxPrice = 0;\nvar MinPrice = 0;\nvar BuyPart = 0;\nvar BuySize = 0;\n\nfunction MinutesBetween(date1,date2) {\n    return  Math.round((((date1 - date2) % 86400000) % 3600000) / 60000);\n}\n\nfunction SecondsBetween(date1,date2) {\n    return  Math.round(((((date1 - date2) % 86400000) % 3600000) % 60000) / 1000);\n}\n\n\nfunction checkOpenOrder(type, price, volume) {\n\tfor (var i = 0; i < trader.get(\"OpenOrdersCount\"); i++) {\n\t\tif ((trader.get(\"OpenOrderType\",i) == type)&&(trader.get(\"OpenOrderPrice\",i) == price)&&(trader.get(\"OpenOrderVolume\",i) == volume)) {\n\t\t\treturn true;\n\t\t}\n\t}\nreturn false;\n}\n\nfunction print_mOpenOrders () {\ntrader.log(\"============ \x421\x442\x435\x43a \x43e\x442\x43a\x440\x44b\x442\x44b\x445 \x43e\x440\x434\x435\x440\x43e\x432 \x441\x43a\x440\x438\x43f\x442\x430 mOpenOrders ============\");\nfor (var i = 0; i < mOpenOrders.length; i++) {\n\ttrader.log(\"   \",i,\") \", mOpenOrders[i].price, mOpenOrders[i].volume);\n}\n}\n\nfunction print_mNotOpenOrders () {\ntrader.log(\"============ \x421\x442\x435\x43a \x43e\x440\x434\x435\x440\x43e\x432 \x441\x43a\x440\x438\x43f\x442\x430 mNotOpenOrders \x43a\x43e\x442\x43e\x440\x44b\x435 \x43d\x435 \x43d\x430\x434\x43e \x43e\x442\x43a\x440\x44b\x432\x430\x442\x44c ============\");\nfor (var i = 0; i < mNotOpenOrders.length; i++) {\n\ttrader.log(\"   \",i,\") \", mNotOpenOrders[i].price, mNotOpenOrders[i].volume);\n}\n}\n\nfunction print_mOpenSellOrders () {\ntrader.log(\"============ \x421\x442\x435\x43a \x43e\x440\x434\x435\x440\x43e\x432 \x441\x43a\x440\x438\x43f\x442\x430 mOpenSellOrders ============\");\nfor (var i = 0; i < mOpenSellOrders.length; i++) {\n\ttrader.log(\"   \",i,\") \", mOpenSellOrders[i].price, mOpenSellOrders[i].volume);\n}\n}\n\nfunction includes_mNotOpenOrders (item) {\nvar result = false;\n//print_mNotOpenOrders();\n//trader.log(\"res = \", result);\n//trader.log(\"item.type = \", item.type);\n//trader.log(\"item.price = \", item.price);\n//trader.log(\"item.volume = \", item.volume);\n//trader.log(\"len = \", mNotOpenOrders.length);\nfor (var i = 0; i < mNotOpenOrders.length; i++) {\n\tif ((mNotOpenOrders[i].type == item.type)&&(mNotOpenOrders[i].price.toFixed(5) == item.price.toFixed(5))&&(mNotOpenOrders[i].volume.toFixed(5) == item.volume.toFixed(5))) {\n//\t\ttrader.log(\"i = \", i);\n//\t\ttrader.log(mNotOpenOrders[i].type, \" = \", item.type);\n//\t\ttrader.log(mNotOpenOrders[i].price.toFixed(6) ,\" = \", item.price.toFixed(6));\n//\t\ttrader.log(mNotOpenOrders[i].volume.toFixed(6) ,\" = \", item.volume.toFixed(6));\n\t\tresult = true;\n\t\tbreak;\n\t}\n}\n\n//trader.log(\"res = \", result);\n\n//if (result) { trader.log(\"Find! price = \", item.price.toFixed(6), \" volume = \", item.volume.toFixed(6));}\n//else { trader.log(\"Not Find! price = \", item.price.toFixed(6), \" volume = \", item.volume.toFixed(6));}\nreturn result;\n}\n\n\n\nfunction DataInitialize() {\n  trader.log('DataInitialize');\n  SetLastOrder = new Date();\n  \n  if (\x421urrentAskPrice == 0) {\n  \t\x421urrentAskPrice = trader.get(\"AskPrice\");\n\t\x421urrentAskPrice = (\x421urrentAskPrice.toFixed(3))/1 - 0.001;\n  }\n  if (\x421urrentBidPrice == 0) {\n  \t\x421urrentBidPrice  = trader.get(\"BidPrice\");\n  }\n  switch (OrderMode) {\n  case 0: \n\tMaxPrice = ManualMax;\n\tMinPrice = ManualMin;\n\tbreak;\n  case 1:\n\tMaxPrice = \x421urrentAskPrice*(1+PercMaxPrice/100);\n\tMinPrice =  \x421urrentBidPrice/(1+PercMinPrice/100);\n\tbreak;\n  case 2:\n\tMaxPrice = trader.get(\"HighPrice\")*(1+PercMaxPrice/100);\n\tMinPrice = trader.get(\"LowPrice\")/(1+PercMinPrice/100);\n\tbreak;\n  }\n\n  trader.log(\"\x421urrentAskPrice = \",\x421urrentAskPrice);\n  trader.log(\"\x421urrentBidPrice = \",\x421urrentBidPrice);\n  trader.log(\"MaxPrice = \",MaxPrice);\n  trader.log(\"MinPrice = \",MinPrice);\n\n  mOpenOrders.length = 0; \n  mNotOpenOrders.length = 0; \n  print_mOpenOrders();\n  print_mNotOpenOrders();  \n  \n  mNotOpenOrders.push(new newOrder(0,1.11111,2.222222));\n  var last = mNotOpenOrders.pop();\n  print_mNotOpenOrders();\n\n}\n\n\n\nBuyPart = 100/OrdersAmnt;\nBuySize = Deposit*BuyPart/100; // \x43e\x440\x434\x435\x440\x430 \x432\x441\x435\x433\x434\x430 \x43f\x43e\x43a\x443\x43f\x430\x44e\x442\x441\x44f \x43d\x430 \x434\x430\x43d\x43d\x443\x44e \x432\x435\x43b\x435\x447\x438\x43d\x443.\n\t\nDataInitialize();\n\nif (vh == 0) {\n\tvh = (\x421urrentAskPrice -  MinPrice)/OrdersAmnt;\n}\nvh = 0.003;\nvar sellcount = 0;\n\ntrader.log(\"vh (\x448\x430\x433) = \", vh);\n\nfor (var i = 1; i < OrdersAmnt+1; i++) {\n\tvar vprice = \x421urrentAskPrice-vh*i;\n\tif (!checkOpenOrder(0, vprice, BuySize/vprice)) {\n\t\ttrader.buy(BuySize/vprice,vprice);\n\t}\n\tmOpenOrders.push(new newOrder(0,vprice,BuySize/vprice)); // \x414\x43e\x431\x430\x432\x43b\x435\x43d\x438\x435 \x432 \x43a\x43e\x43d\x435\x446 \x43c\x430\x441\x441\x438\x432\x430\n}\n\nprint_mOpenOrders();\nprint_mNotOpenOrders();\n\ntrader.on(\"LastMySellPrice\").changed()\n{\ntrader.log(\"LastMySellPrice.changed\");\n// \x41f\x440\x43e\x438\x437\x43e\x448\x43b\x430 \x43f\x440\x43e\x434\x430\x436\x430!!! \x41d\x430\x434\x43e \x443\x431\x440\x430\x442\x44c \x44d\x43b\x435\x43c\x435\x43d\x442 \x438\x437 \x43c\x430\x441\x441\x438\x432\x430 mNotOpenOrders\n//var last = mNotOpenOrders.pop(); // \x418\x441\x43a\x43b\x44e\x447\x438\x43b\x438 \x43f\x43e\x441\x43b\x435\x434\x43d\x438\x439 \x44d\x43b\x435\x43c\x435\x43d\x442 \x43c\x430\x441\x441\x438\x432\x430\t\n//print_mNotOpenOrders();\nfor (var i = mOpenSellOrders.length-1; i > -1; i--) {\n\t\tvar vFind = false;\n\t\tfor (var j = 0; j < trader.get(\"OpenOrdersCount\") ; j++) {\n\t\t\ttrader.log(mOpenSellOrders[i].type,\" = \", trader.get(\"OpenOrderType\",j));\n\t\t\tvar v_oop = trader.get(\"OpenOrderPrice\",j);\n\t\t\ttrader.log(mOpenSellOrders[i].price.toFixed(5),\" = \", v_oop);\n\t\t\tvar v_oov = trader.get(\"OpenOrderVolume\",j);\n\t\t\ttrader.log(mOpenSellOrders[i].volume.toFixed(5),\" = \", v_oov);\nif (mOpenSellOrders[i].type == 1 && trader.get(\"OpenOrderType\",j) == 1 && mOpenSellOrders[i].price.toFixed(5) == trader.get(\"OpenOrderPrice\",j).toFixed(5) && mOpenSellOrders[i].volume.toFixed(5) == trader.get(\"OpenOrderVolume\",j).toFixed(5)) {\n\t\t\t\t// \x41d\x430\x448\x43b\x438!!!\n\t\t\t\tvFind = true;\n\t\t\t\ttrader.log(\"FIND!!!\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!vFind) { // \x41d\x430\x448\x43b\x438 :)\n\t\t\tvar last = mNotOpenOrders.pop(); // \x418\x441\x43a\x43b\x44e\x447\x438\x43b\x438 \x43f\x43e\x441\x43b\x435\x434\x43d\x438\x439 \x44d\x43b\x435\x43c\x435\x43d\x442 \x43c\x430\x441\x441\x438\x432\x430\t\x43b\x443\x447\x448\x435 \x431\x44b \x438\x441\x43a\x43b\x44e\x447\x438\x442\x44c i \x44d\x43b\x435\x43c\x435\x43d\x442\n\t\t\tprint_mNotOpenOrders();\n\t\t\tvar last = mOpenSellOrders.pop(); // \x418\x441\x43a\x43b\x44e\x447\x438\x43b\x438 \x43f\x43e\x441\x43b\x435\x434\x43d\x438\x439 \x44d\x43b\x435\x43c\x435\x43d\x442 \x43c\x430\x441\x441\x438\x432\x430\t\x43b\x443\x447\x448\x435 \x431\x44b \x438\x441\x43a\x43b\x44e\x447\x438\x442\x44c i \x44d\x43b\x435\x43c\x435\x43d\x442\n\t\t\tprint_mOpenSellOrders();\n\t\t}\n\t}\n}\n\n\ntrader.on(\"LastMyBuyPrice\").changed()\n{\nvar correct_i = 0;\ntrader.log(\"LastMyBuyPrice.changed!!!\");\n// \x41f\x440\x43e\x438\x437\x43e\x448\x43b\x430 \x43f\x43e\x43a\x443\x43f\x43a\x430!!!  - \x41f\x435\x440\x435\x43f\x438\x441\x430\x442\x44c!!! \x435\x441\x43b\x438 \x43f\x43e\x43a\x443\x43f\x43a\x430 \x43f\x440\x43e\x438\x437\x43e\x448\x43b\x430 \x43d\x435\x441\x43a\x43e\x43b\x44c\x43a\x438\x445 \x43e\x440\x434\x435\x440\x43e\x432, \x442\x43e \x43d\x435 \x441\x440\x430\x431\x430\x442\x44b\x432\x430\x435\x442 \x43c\x43d\x43e\x433\x43e \x440\x430\x437!!! \x441\x440\x430\x431\x430\x442\x44b\x432\x430\x435\x442 1 \x440\x430\x437!!!\nfor (var i = mOpenOrders.length-1; i > -1; i--) {\n\t\tvar vFind = false;\n\t\tfor (var j = 0; j < trader.get(\"OpenOrdersCount\") ; j++) {\n\t\t\t//trader.log(mOpenOrders[i].type,\" = \", trader.get(\"OpenOrderType\",j));\n\t\t\t//var v_oop = trader.get(\"OpenOrderPrice\",j);\n\t\t\t//trader.log(mOpenOrders[i].price.toFixed(6),\" = \", v_oop);\n\t\t\t//var v_oov = trader.get(\"OpenOrderVolume\",j);\n\t\t\t//trader.log(mOpenOrders[i].volume.toFixed(6),\" = \", v_oov);\nif (mOpenOrders[i].type == 0 && trader.get(\"OpenOrderType\",j) == 0 && mOpenOrders[i].price.toFixed(5) == trader.get(\"OpenOrderPrice\",j).toFixed(5) && mOpenOrders[i].volume.toFixed(5) == trader.get(\"OpenOrderVolume\",j).toFixed(5)) {\n\t\t\t\t// \x41d\x430\x448\x43b\x438!!!\n\t\t\t\tvFind = true;\n\t\t\t\ttrader.log(\"FIND!!!\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!vFind) { // \x41d\x435 \x43d\x430\x448\x43b\x438 :(\n\t\t\t// \x41f\x440\x43e\x438\x437\x43e\x448\x43b\x430 \x43f\x43e\x43a\x443\x43f\x43a\x430!!!  - \x41f\x435\x440\x435\x43f\x438\x441\x430\x442\x44c!!! \x435\x441\x43b\x438 \x43f\x43e\x43a\x443\x43f\x43a\x430 \x43f\x440\x43e\x438\x437\x43e\x448\x43b\x430 \x43d\x435\x441\x43a\x43e\x43b\x44c\x43a\x438\x445 \x43e\x440\x434\x435\x440\x43e\x432, \x442\x43e \x43d\x435 \x441\x440\x430\x431\x430\x442\x44b\x432\x430\x435\x442 \x43c\x43d\x43e\x433\x43e \x440\x430\x437!!! \x441\x440\x430\x431\x430\x442\x44b\x432\x430\x435\x442 1 \x440\x430\x437!!!\t\t\t\n\t\t\ttrader.sell(mOpenOrders[i+correct_i].volume,((1 + ProfitSize*0.01)*mOpenOrders[i+correct_i].price));\n\t\t\tmOpenSellOrders.push(new newOrder(1,(1 + ProfitSize*0.01)*mOpenOrders[i+correct_i].price,mOpenOrders[i+correct_i].volume));\n\t\t\tmNotOpenOrders.push(new newOrder(0,mOpenOrders[i+correct_i].price,mOpenOrders[i+correct_i].volume)); // \x432 \x43a\x43e\x43d\x435\x446 \x43c\x430\x441\x441\x438\x432\x430\n\t\t\tprint_mNotOpenOrders();\n\t\t\tprint_mOpenSellOrders();\n\n\t\t\t//trader.log(\"\x41f\x440\x43e\x438\x437\x43e\x448\x43b\x430 \x43f\x43e\x43a\x443\x43f\x43a\x430!!!\");\n\t\t\ttrader.log(\"\x426\x435\x43d\x430 \x43f\x440\x43e\x434\x430\x436\x438 = \", ((1 + ProfitSize*0.01)*mOpenOrders[i+correct_i].price));\n\t\t\t//trader.log(\"mOpenOrders[0].price = \", mOpenOrders[0].price);\n\n\t\t\t//var last = mOpenOrders.shift(); // \x418\x441\x43a\x43b\x44e\x447\x430\x435\x43c \x43f\x435\x440\x432\x44b\x439 \x44d\x43b\x435\x43c\x435\x43d\x442 \x43c\x430\x441\x441\x438\x432\x430. \x43b\x443\x447\x448\x435 \x431\x44b \x438\x441\x43a\x43b\x44e\x447\x438\x442\x44c i \x44d\x43b\x435\x43c\x435\x43d\x442\n\t\t\tmOpenOrders.splice(i+correct_i,1);  // \x43f\x435\x440\x435\x43f\x438\x441\x430\x43b\t\t\t\n\n\t\t\tvar vprice = mOpenOrders[mOpenOrders.length-1].price - vh;\n\t\t\ttrader.buy(BuySize/vprice,vprice);\n\t\t\tmOpenOrders.push(new newOrder(0,vprice,BuySize/vprice)); // \x432 \x43a\x43e\x43d\x435\x446 \x43c\x430\x441\x441\x438\x432\x430\n\t\t\tprint_mOpenOrders();\n\t\t\tcorrect_i++;\n\t\t}\n\t}\n}\n\n\ntrader.on(\"Time\").changed()\n{\nif (SecondsBetween(new Date(),SetLastOrder) > 5) {\nSetLastOrder = new Date();\n//trader.log(\"time!!! \", vh);\n//print_mOpenOrders();\n//print_mNotOpenOrders();\nvar vprice = mOpenOrders[0].price + vh;\nif (trader.get(\"AskPrice\") >= mOpenOrders[0].price + 2*vh) { \n\t//trader.log(\"AskPrice >= mOpenOrders[0].price + 2*vh\");\n\tif (! includes_mNotOpenOrders (new newOrder(0,vprice,BuySize/vprice))) {\n\t\ttrader.log(\"\x426\x435\x43d\x430 \x43f\x43e\x43a\x443\x43f\x43a\x438 \x431\x43e\x43b\x44c\x448\x435 \x447\x435\x43c \x43c\x430\x43a\x441 \x446\x435\x43d\x430 \x43e\x440\x434\x435\x440\x430 + 2 \x448\x430\x433\x430\");\n\t\ttrader.log(\"\x426\x435\x43d\x430 \x43f\x43e\x43a\x443\x43f\x43a\x438 = \", trader.get(\"AskPrice\"));\n\t\ttrader.log(\"mOpenOrders[0].price = \", mOpenOrders[0].price);\n\t\n\t\ttrader.cancelBid(mOpenOrders[mOpenOrders.length-1].volume.toFixed(8),mOpenOrders[mOpenOrders.length-1].price.toFixed(8));\n\t\ttrader.log(\"CancelBid price = \",mOpenOrders[mOpenOrders.length-1].price.toFixed(8), \" volume = \", mOpenOrders[mOpenOrders.length-1].volume.toFixed(8));\n\t\tvar last = mOpenOrders.pop(); // \x418\x441\x43a\x43b\x44e\x447\x438\x43b\x438 \x43f\x43e\x441\x43b\x435\x434\x43d\x438\x439 \x44d\x43b\x435\x43c\x435\x43d\x442 \x43c\x430\x441\x441\x438\x432\x430\t\n\n\t\ttrader.buy(BuySize/vprice,vprice);\n\t\tmOpenOrders.unshift(new newOrder(0,vprice,BuySize/vprice)); // \x432 \x43d\x430\x447\x430\x43b\x43e \x43c\x430\x441\x441\x438\x432\x430\n\t\tprint_mOpenOrders();\t\n\t}\n}\n}\n}\n"
